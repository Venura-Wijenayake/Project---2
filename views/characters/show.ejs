<%- include('../partials/header') %>

<main class="container">
    <div class="back-button">
        <a href="/characters" class="btn btn-primary">Back to Character Index</a>
    </div>
    <h1 class="headerContainer">Character Details</h1>

  <div class="character-info">
    <h2><strong><%= character.name %></strong></h2>
    <p><strong>Player Name:</strong> <%= character.playerName %></p>
    <p><strong>Career Path:</strong> <%= character.careerPath %></p>
    <p><strong>Rank:</strong> <%= character.rank %></p>
    <p><strong>Homeworld:</strong> <%= character.homeworld %></p>
    <p><strong>Motivation:</strong> <%= character.motivation %></p>
    <p><strong>Description:</strong> <%= character.description %></p>
  </div>

  <div class="attributes">
    <h3>Attributes</h3>
    <table>
      <thead>
        <tr>
          <th>Weapon Skill</th>
          <th>Ballistic Skill</th>
          <th>Strength</th>
          <th>Toughness</th>
          <th>Agility</th>
          <th>Intelligence</th>
          <th>Perception</th>
          <th>Will Power</th>
          <th>Fellowship</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= character.weaponSkill %></td>
          <td><%= character.ballisticSkill %></td>
          <td><%= character.strength %></td>
          <td><%= character.toughness %></td>
          <td><%= character.agility %></td>
          <td><%= character.intelligence %></td>
          <td><%= character.perception %></td>
          <td><%= character.willPower %></td>
          <td><%= character.fellowship %></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="talents-traits">
    <h3>Talents & Traits</h3>
    <p><%= character.talentsAndTraits %></p>
  </div>

  <div class="special-abilities">
    <h3>Special Abilities</h3>
    <p><%= character.specialAbilities %></p>
  </div>

  <div class="psychic-disciplines">
    <h3>Psychic Disciplines</h3>
    <p><%= character.psychicDisciplines %></p>
  </div>

  <div class="psychic-techniques">
    <h3>Psychic Techniques</h3>
    <p><%= character.psychicTechniques %></p>
  </div>

  <div class="profit-factor">
    <h3>Profit Factor</h3>
    <p><strong>Starting Profit Factor:</strong> <%= character.startingProfitFactor %></p>
    <p><strong>Current Profit Factor:</strong> <%= character.currentProfitFactor %></p>
  </div>

  <div class="experience-points">
    <h3>Experience Points</h3>
    <p><strong>Misfortunes:</strong> <%= character.misfortunes %></p>
    <p><strong>Exp Points To Spend:</strong> <%= character.experiencePointsToSpend %></p>
    <p><strong>Exp Points Spent:</strong> <%= character.experiencePointsSpent %></p>
  </div>
</main>

<main class="container">
  <section class="add-items-section">
    <h1 class="headerContainer">ADD ITEMS</h1>
    <form id="add-per-to-cast" action="/items/characters/<%= character._id %>/items" method="POST">
      <div class="add-items-form">
        <select name="itemId">
          <!-- Emit an option for each item -->
          <% items.forEach(item => { %>
            <option value="<%= item._id %>"><%= item.name %></option>
          <% }); %>
        </select>
        <button type="submit">Add to Items</button>
      </div>
    </form>
  </section>

  <!-- ADDED ITEMS section -->
  <section class="added-items-section">
    <div class="added-items">
      <h3>Added Items:</h3>
      <div class="added-items-grid">
        <% character.itemsHeld.forEach(itemId => { %>
          <% const item = items.find(item => item._id.toString() === itemId.toString()); %>
          <% if (item) { %>
            <div class="added-item">
              <span><%= item.name %></span>
              <form action="/items/characters/<%= character._id %>/items/<%= item._id %>?_method=DELETE" method="POST">
                <button type="submit">Remove</button>
              </form>
            </div>
          <% } %>
        <% }); %>
      </div>
    </div>
  </section>
</main>

<!-- CURRENT LOCATION section -->
<!-- CURRENT LOCATION section -->
<main class="container">
  <section class="add-items-section">
    <h1 class="headerContainer">SET LOCATION:</h1>
    <form id="add-per-to-cast" action="/locations/characters/<%= character._id %>/locations" method="POST">
      <div class="add-items-form">
        <select name="locationId">
          <!-- Emit an option for each location -->
          <% locations.forEach(location => { %>
            <option value="<%= location._id %>"><%= location.name %></option>
          <% }); %>
        </select>
        <button type="submit">Add Location</button>
      </div>
    </form>
  </section>

  <section class="added-items-section">
    <div class="added-items">
      <h3>Current Location:</h3>
      <div class="added-items-grid">
        <% character.locationHeld.forEach(locationId => { %>
          <% const location = locations.find(location => location._id.toString() === locationId.toString()); %>
          <% if (location) { %>
            <div class="added-item">
              <span class="centered"><%= location.name %></span>
              <form action="/locations/characters/<%= character._id %>/locations/<%= location._id %>?_method=DELETE" method="POST">
                <button type="submit">Remove</button>
              </form>
            </div>
          <% } %>
        <% }); %>
      </div>
    </div>
  </section>
</main>

<%- include('../partials/footer') %>

